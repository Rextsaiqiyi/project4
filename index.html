<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8 />
<title></title>
<script src='https://api.mapbox.com/mapbox.js/v3.3.1/mapbox.js'></script>
<link href='https://api.mapbox.com/mapbox.js/v3.3.1/mapbox.css' rel='stylesheet' />
<link href='https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.css' rel='stylesheet' />
<script src='https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.js'></script>
<script src='https://api.mapbox.com/mapbox.js/plugins/turf/v3.0.11/turf.min.js'></script>
<style>
  body {
    margin: 0;
    padding: 0;
  }

  #map {
    position: absolute;
    top: 0;
    bottom: 0;
    width: 100%;
  }
</style>
</head>
<body>
<div id='map'></div>

<script>
mapboxgl.accessToken = 'pk.eyJ1IjoicmV4dHNhaXFpeWkiLCJhIjoiY2trbDF5bGFoMDNxejJwcnIwaTJiZGQ0cSJ9.yOz5JUClaJJrPgdOthH8vg';
var map = new mapboxgl.Map({
  container: 'map', // container id
  style: 'mapbox://styles/mapbox/light-v10', // stylesheet location
  center: [-114.08529, 51.05011], // starting position
  zoom: 12 // starting zoom
});

var school = "https://data.calgary.ca/resource/fd9t-tdn2.geojson";

var community ={
   "type": "FeatureCollection",
   "features": [
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ -114.06391459432675,51.11218619333126 ]
    },
    "properties": {
    "TYPE":"PHS Clinic",
    "NAME":"Thornhill Community Health Centre",
    "ADDRESS":"6617 Centre ST NW",
    "COMM_CODE":"HUN",
    "location":"(51.11218619333126, -114.06391459432675)"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ -114.10650709115143,51.06532159267874 ]
    },
    "properties": {
    "TYPE":"PHS Clinic",
    "NAME":"North Hill Community Health Centre",
    "ADDRESS":"1527 19 ST NW",
    "COMM_CODE":"HOU",
    "location":"(51.06532159267874, -114.10650709115143)"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ -114.07212956123551,51.04116344159869 ]
    },
    "properties": {
    "TYPE":"PHS Clinic",
    "NAME":"Sheldon M. Chumir Health Centre",
    "ADDRESS":"1213 - 4 ST SW",
    "COMM_CODE":"BLN",
    "location":"(51.04116344159869, -114.07212956123551)"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ -114.13217660430655,51.064182937103176 ]
    },
    "properties": {
    "TYPE":"Hospital",
    "NAME":"Foothills Hospital",
    "ADDRESS":"1403 - 29 ST NW",
    "COMM_CODE":"STA",
    "location":"(51.064182937103176, -114.13217660430655)"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ -113.98394351382268,51.07901634932495 ]
    },
    "properties": {
    "TYPE":"Hospital",
    "NAME":"Peter Lougheed Medical Centre",
    "ADDRESS":"3500 - 26 AV NE",
    "COMM_CODE":"SUN",
    "location":"(51.07901634932495, -113.98394351382268)"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ -113.95355569514419,51.07553892796213 ]
    },
    "properties": {
    "TYPE":"PHS Clinic",
    "NAME":"Village Square Community Health Centre",
    "ADDRESS":"2623 - 56 ST NE",
    "COMM_CODE":"PIN",
    "location":"(51.07553892796213, -113.95355569514419)"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ -113.9672200855659,51.04504854027524 ]
    },
    "properties": {
    "TYPE":"PHS Clinic",
    "NAME":"East Calgary Health Centre",
    "ADDRESS":"4715 8 AV SE",
    "COMM_CODE":"FLN",
    "location":"(51.04504854027524, -113.9672200855659)"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ -114.14795761511185,51.07455988033879 ]
    },
    "properties": {
    "TYPE":"Hospital",
    "NAME":"Alberta Children's Hospital",
    "ADDRESS":"2888 Shaganappi Trail NW",
    "COMM_CODE":"UOC",
    "location":"(51.07455988033879, -114.14795761511185)"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ -113.95170381192895,50.88210185113848 ]
    },
    "properties": {
    "TYPE":"Hospital",
    "NAME":"South Health Campus",
    "ADDRESS":"4448 FRONT ST SE",
    "COMM_CODE":"SET",
    "location":"(50.88210185113848, -113.95170381192895)"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ -114.0709401043907,50.97507203441003 ]
    },
    "properties": {
    "TYPE":"PHS Clinic",
    "NAME":"Acadia Community Health Centre",
    "ADDRESS":"151 - 86 AV SE",
    "COMM_CODE":"ACA",
    "location":"(50.97507203441003, -114.0709401043907)"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ -114.05857497443219,50.90257527258776 ]
    },
    "properties": {
    "TYPE":"PHS Clinic",
    "NAME":"South Calgary Health Centre",
    "ADDRESS":"31 Sunpark Plaza SE",
    "COMM_CODE":"SDC",
    "location":"(50.90257527258776, -114.05857497443219)"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ -114.13684189371192,51.04488712410958 ]
    },
    "properties": {
    "TYPE":"PHS Clinic",
    "NAME":"Shaganappi Complex Health Centre",
    "ADDRESS":"3415 - 8 AV SW",
    "COMM_CODE":"SPR",
    "location":"(51.04488712410958, -114.13684189371192)"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ -114.09632069904508,50.991828888017004 ]
    },
    "properties": {
    "TYPE":"Hospital",
    "NAME":"Rockyview General Hospital",
    "ADDRESS":"7007 - 14 ST SW",
    "COMM_CODE":"EAG",
    "location":"(50.991828888017004, -114.09632069904508)"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ -114.1971615208791,51.123333552258295 ]
    },
    "properties": {
    "TYPE":"PHS Clinic",
    "NAME":"Northwest Community Health Centre",
    "ADDRESS":"109 1829 Ranchlands BV NW",
    "COMM_CODE":"RAN",
    "location":"(51.123333552258295, -114.1971615208791)"
    }
  }
]
};

          map.on('load',function(){
            map.addLayer({
              id: 'school',
              type: 'symbol',
              source:{
                type:'geojson',
                data: school
              },
              layout:{
                'icon-image':'library-15'
              },
              paint:{}
            });
            map.addLayer({
              id: 'community',
              type: 'symbol',
              source:{
                type:'geojson',
                data: community
              },
              layout:{
                'icon-image':'hospital-15',
                'icon-allow-overlap':true
              },
              paint:{}
            });
            map.addSource('nearest-hospital', {
              type: 'geojson',
              data: {
                type: 'FeatureCollection',
                features: [
                ]
              }
            });
            map.addSource('nearest-school', {
              type: 'geojson',
              data: {
                type: 'FeatureCollection',
                features: [
                ]
              }
            });
          });

          map.on('click', function(e) {
            var schoolFeatures = map.queryRenderedFeatures(e.point, { layers: ['school'] });
            if (!schoolFeatures.length) {
              return;
            }
            var schoolFeature = schoolFeatures[0];

            var nearestHospital = turf.nearest(schoolFeature, community);

            if (nearestHospital !== null) {
              map.getSource('nearest-hospital').setData({
                type: 'FeatureCollection',
                features: [
                  nearestHospital
                ]
              });
              map.addLayer({
                id: 'nearest-hospital',
                type: 'circle',
                source: 'nearest-hospital',
                paint: {
                  'circle-radius': 15,
                  'circle-color': '#00FF00'
                }
              }, 'community');
            }
          });


</script>
</body>
</html>
